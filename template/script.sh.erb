#!/bin/bash

# Set working directory
cd "${HOME}"

# Path to your Singularity container
APPTAINERIMAGE="$HOME/ondemand/dev/JupyterGIS/jupytergis-notebook_ood.sif"

# Notebook directory
NOTEBOOK_DIR="${HOME}/jupytergis_notebooks"
mkdir -p "${NOTEBOOK_DIR}"

# Debug: Log environment variables and verify CONFIG_FILE
echo "CONFIG_FILE=$CONFIG_FILE"
echo "Port from before.sh.erb: $port"
if [ -f "$CONFIG_FILE" ]; then
    echo "CONFIG_FILE exists on host"
else
    echo "ERROR: CONFIG_FILE not found on host at $CONFIG_FILE"
fi

# Launch JupyterGIS with the config file, binding the session directory
apptainer exec --bind "$(dirname ${CONFIG_FILE}):/mnt/config" \
               "${APPTAINERIMAGE}" /home/jovyan/start-notebook.sh
